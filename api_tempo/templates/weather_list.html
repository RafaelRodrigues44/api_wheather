{% extends 'base.html' %}

{% block content %}
    <h2 style="text-align: center;">Dados Meteorológicos</h2>

    <form id="search-form" action="{% url 'get_weather_by_city' city='placeholder' %}" method="GET">
        <label for="search">Pesquisar:</label>
        <input type="text" id="search" name="city">
        <button type="submit">Procurar</button>
    </form>
    
    <div class="weather-list-container">
        <ul class="weather-list">
            {% for weather in weather_collections %}
                <li class="weather-item">
                    <h3>Cidade: {{ weather.city }}</h3>
                    <p>Data: {{ weather.date }}</p>
                    <p>Temperatura: {{ weather.temperature }}</p>
                    <p>Pressão: {{ weather.pressure }}</p>
                    <p>Umidade: {{ weather.humidity }}</p>
                    <p>Precipitação: {{ weather.precipitation }}</p>
                    <p>Condição: {{ weather.weather_condition }}</p>
                    
                    <!-- Botão de exclusão -->
                    <button class="delete-btn" data-document-id="{{ weather.id }}">Excluir</button>
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Script JavaScript -->
    <script>
        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault(); 

            var city = document.getElementById('search').value; 

            // Atualiza o atributo 'action' do formulário com o endpoint desejado
            var formAction = document.getElementById('search-form').getAttribute('action');
            formAction = formAction.replace('placeholder', city);
            document.getElementById('search-form').setAttribute('action', formAction);

            // Envie o formulário
            this.submit();
        });

        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function() {
                var documentId = this.getAttribute('data-document-id');
                console.log(documentId)
                var deleteUrl = '/weather/delete/' + documentId; 
                window.location.href = deleteUrl; 
            });
        });
    </script>
{% endblock %}

